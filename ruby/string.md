# String

## `#sub` で regexp の `|` を使う時に注意したいこと

`#sub` `#gsub` する際に正規表現の選択子 (`|`) を使うことができるが、  
正規表現をベースにチェックしていくのではなく、文字列をベースに 1 文字ずつイテレートしながらチェックする。  
ので、意識せず `|` を使っていると思わぬところでハマりそう。

- Ruby の正規表現エンジンに限った話ではなく、 [正規表現チェッカー（JavaScript版）](https://www.softel.co.jp/labs/tools/regex/) でチェックした時も同じ挙動だったのでおそらく一般的な挙動
- `正規表現制御型（regexp-directed）エンジン` の挙動らしい
  - [はじめての正規表現とベストプラクティス#5（特別編）`|`と部分マッチのワナ｜TechRacho](https://techracho.bpsinc.jp/hachi8833/2018_11_30/65123)
  - `テキスト制御型（text-directed）エンジン` だとこの辺りの挙動が変わるらしい
- Ruby の正規表現ライブラリは [Onigumo](https://github.com/k-takata/Onigmo)

```ruby
# "abc" を /a/ /ab/ /bc/ のパターンを使ってマッチさせたい場合

# /ab/ がなければ話は簡単
"abc".gsub(/bc|a/, "")
=> ""

# パターンとしては /bc/ が先にあるが、文字列をベースにチェックしていくので "a" と/ab/ が先にマッチする
"abc".gsub(/bc|ab|a/, "")
# => "c"

# 先にマッチさせたいパターンを単独で先にマッチさせると期待通りの挙動となる
"abc".gsub(/bc/, "").gsub(/ab|a/, "")
# => ""
```
